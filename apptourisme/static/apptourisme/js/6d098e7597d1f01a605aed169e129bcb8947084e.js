var _i_=this._i_||function(){},_r_=this._r_||function(e){return e};B.define("hotel/tpi/data-api",function(e,t,i){_i_("50d:db394208");var r,_,f="PPXGFRURURYAQDFO",d=e("et"),h=e("fragment"),a=e("promise");function u(e,t){return _i_("50d:765694c3"),"www"===B.env.b_site_type&&"hotel"===B.env.b_action&&d.customGoal(f,1),_r_($.ajax({type:"POST",url:e,data:JSON.stringify(t),cache:!1,xhrFields:{withCredentials:!0},dataType:"json",contentType:"application/json; charset=utf-8",timeout:2e4}))}function p(e){_i_("50d:a0cb4c70"),B.squeak&&B.env.wholesaler_configuration.tpi_track_ajax_failures&&e&&B.squeak(e),_r_()}function b(e,t){return _i_("50d:c6ffc0a4"),_r_(function(){return _i_("50d:084bf321"),_r_(e.apply(t,arguments))})}function m(){return _i_("50d:8d2c6544"),_r_((new Date).getTime())}function v(e,t){return _i_("50d:7dd93ba2"),_r_(t-e)}i.exports={run:function(o,n,s,c,e){_i_("50d:0370e2bc");var l=(B.env||{}).wholesaler_configuration||{};return _&&e&&(_.should_abort=1,r=void 0),r||(r=new a(b(function(i,r){if(_i_("50d:521a35e0"),o&&n&&s&&c||r("Error: Missing args, avData, avData, frgName and frgData  are required"),this.time_before_carrier_call=m(),"www"===B.env.b_site_type&&"hotel"===B.env.b_action&&B.env.wholesaler_configuration.worker_url&&B.env.wholesaler_configuration.decision_url&&B.env.b_fragment_url_json&&d.track(f)){var e=B.env.b_fragment_url_json.split("?"),t=1<e.length?e[1]:"",_=Object.assign({},n),a=Object.assign({},c);a.exps=B.env.wholesaler_configuration.tpi_exps||{},_.url=o,_.worker_token=B.env.wholesaler_configuration.worker_token,_.frag_url=B.env.wholesaler_configuration.decision_url+"?"+t,_.frag_req=a,u(B.env.wholesaler_configuration.worker_url,_).then(b(function(e){if(_i_("50d:427c4dd7"),this.time_after_fragment_response=m(),this.should_abort)r("frg-aborted");else if(e&&e.data)if(d.customGoal(f,4),B.squeak(l.tpi_av_soa_squeak_name),d.goalWithValue("js_tpi_www_soa_time_to_response",v(this.time_before_carrier_call,this.time_after_fragment_response)),1<d.track(f)){var t=function(){_i_("50d:2215446d"),i(e.data),_r_()};2==d.track(f)?setTimeout(t,1e3):setTimeout(t,3e3)}else i(e.data);else r("frg-error");_r_()},this),function(e,t){_i_("50d:30f6c172"),t&&"timeout"===t?(d.customGoal(f,2),p(l.tpi_av_timeout_squeak_name)):(d.customGoal(f,3),p(l.tpi_av_squeak_name)),r("av-error"),_r_()})}else u(o,n).then(b(function(e){if(_i_("50d:fa5c620b"),this.should_abort)return r("av-aborted"),_r_();var t=Object.assign({},c,{rooms:e,exps:B.env.wholesaler_configuration.tpi_exps||{}});h.call(s,t).then(b(function(e){_i_("50d:f33c5e95"),this.time_after_fragment_response=m(),this.should_abort?r("frg-aborted"):e?("www"===B.env.b_site_type&&"hotel"===B.env.b_action&&(d.customGoal(f,4),d.goalWithValue("js_tpi_www_soa_time_to_response",v(this.time_before_carrier_call,this.time_after_fragment_response))),i(e)):r("frg-error"),_r_()},this),function(e){_i_("50d:7ee51c93"),"www"===B.env.b_site_type&&"hotel"===B.env.b_action&&d.customGoal(f,3),p(l.tpi_frg_squeak_name),r("frg-error"),_r_()}),_r_()},this),function(e,t,i){_i_("50d:5c80c0f6"),l.tpi_av_badrequest_squeak_name&&400===e.status?(p(l.tpi_av_badrequest_squeak_name),"www"===B.env.b_site_type&&"hotel"===B.env.b_action&&d.customGoal(f,3)):t&&"timeout"===t?("www"===B.env.b_site_type&&"hotel"===B.env.b_action&&d.customGoal(f,2),p(l.tpi_av_timeout_squeak_name)):("www"===B.env.b_site_type&&"hotel"===B.env.b_action&&d.customGoal(f,3),p(l.tpi_av_squeak_name)),r("av-error"),_r_()});_r_()},_={}))),_r_(r)}},_r_()}),B.define("hotel/tpi/postproc-api",function(e,t,i){_i_("50d:cca324dc"),i.exports={send_postproc_request:function(e){_i_("50d:97faa462");var t="";"object"==typeof e?(e.forEach(function(e){_i_("50d:1bdb3ed6"),t+=e+"_",_r_()}),t=t.substring(0,t.length-1)):t=""+e;var i=B.env.b_countrycode;$.getJSON("/tpi_postproc?hotel_ids="+t+"&cc="+i+"&src=sr",null,function(){}),_r_()}},_r_()}),B.define("searchresults/tpi/data-api",function(e,t,i){_i_("50d:623da6bd");var r=new(B.require("event-emitter"));i.exports={emitTpiDataEvent:function(e){_i_("50d:936f124e"),r.emit("tpi_data",e),_r_()},onTpiData:function(e){_i_("50d:96a6acd1"),r.on("tpi_data",e),_r_()}},_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration&&!B.env.fe_is_tdot}).run(function(_){_i_("50d:a8d8417a");var a=_("searchresults/tpi/data-api"),o=_("hotel/tpi/data-api"),n="www"===B.env.b_site_type,e="mdot"===B.env.b_site_type;function i(){_i_("50d:8b9a7075");var e,t=(e="wholesaler_configuration",_i_("50d:26e9d9d1"),_r_(n?_("searchresults/env").get(e):B.env[e]));if(t&&t.availability_api_request&&t.decision_fragment_request){var i=Object.assign({},t.availability_api_request);i.use_cache=t.use_cache;var r=Object.assign({},t.decision_fragment_request);o.run(t.b_wholesaler_url,i,"wholesaler.decide_winner_rooms",r,!0).then(function(e){_i_("50d:432ff3c1"),null!=e&&a.emitTpiDataEvent(function(e){_i_("50d:c986843b");var t={data:{},status:200,status_response:"OK"};for(var i in e){if("exps"===i)continue;t.data[i]=[];var r=e[i],_={};_.wholesaler_code=r.min_room_block.wholesaler_code?r.min_room_block.wholesaler_code:"ag",_.price_formatted=r.min_room_block.price_formatted,_.price_inclusion=r.min_room_block.price_inclusion,_.price_user_currency=r.min_price,_.room_name=r.min_room_block.room_name,_.room_info=r.min_room_block.room_description,_.cancellation_information=r.min_room_block.cancellation_information,_.reservation_meta_data={ratechannel:"Retail"},t.data[i].push(_)}e.exps&&(t.exps=e.exps);return _r_(t)}(e)),_r_()}).catch(function(){})}_r_()}if(n){var t=_("searchresults/events");t.on(t.DATA_ENVIRONMENT_UPDATED,i)}if(e){var r="PPXGWPHDDHUFAHNCGVTaNVJVFHT",s=_("event-bus");s.on(s.EVENTS.SR_AJAX_LOADED,function(e,t){_i_("50d:d520244c"),0<=t.blocks.indexOf("results")&&(B.et.stage(r,1),B.et.track(r)&&i()),_r_()})}i(),_r_()}),B.define("searchresults/tpi/user-utils",function(e,t,i){_i_("50d:4aee45db");var r=B.require("et"),_={TRACKING_ASPECTS:{ALWAYS:"always",IS_GENIUS:"genius",IS_LOGGED_IN:"loggedin",IS_ASIAN:"asian",IS_EARLY:"early",IS_LAST_MINUTE:"lastminute",IS_DOMESTIC:"domestic",IS_INTERNATIONAL:"international",IS_META:"meta"},trackUser:function(e,t){var i;_i_("50d:98c03e0d"),void 0!==(i=t?t[_.TRACKING_ASPECTS.ALWAYS]:1)&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_GENIUS]:2)&&B.env.b_reg_user_is_genius&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_LOGGED_IN]:3)&&0<B.env.auth_level&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_ASIAN]:4)&&_.isUserAsian()&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_EARLY]:5)&&_.isEarlyBooker()&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_DOMESTIC]:6)&&B.env.b_countrycode===B.env.b_guest_country&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_INTERNATIONAL]:7)&&B.env.b_countrycode!==B.env.b_guest_country&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_LAST_MINUTE]:8)&&_.isLastMinuteBooker()&&r.stage(e,i),void 0!==(i=t?t[_.TRACKING_ASPECTS.IS_META]:9)&&"meta"==B.env.b_partner_vertical&&r.stage(e,i),_r_()},isUserAsian:function(){_i_("50d:ee3537b5");var e=!1,t=["cn","kp","kh","mm","la","ph","bn","bt","np","hk","th","mo","sg","jp","lk","id","mv","mn","bd","in","vn","kr","tw","my"];if(B.env.b_guest_country)for(var i=0;i<t.length;i++)t[i]==B.env.b_guest_country&&(e=!0);return _r_(e)},isLastMinuteBooker:function(){if(_i_("50d:31024b7d"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),t=new Date,i=Math.abs(e.getTime()-t.getTime());if(Math.ceil(i/864e5)<=3)return _r_(!0)}return _r_(!1)},isEarlyBooker:function(){if(_i_("50d:ee7d2bef"),B.env.b_checkin_date){var e=new Date(B.env.b_checkin_date),t=new Date,i=Math.abs(e.getTime()-t.getTime());if(30<=Math.ceil(i/864e5))return _r_(!0)}return _r_(!1)}};i.exports=_,_r_()}),B.when({action:"searchresults",events:"ready",condition:1==B.env.b_bookings_owned&&B.env.wholesaler_configuration&&B.env.wholesaler_configuration.availability_api_request}).run(function(i){_i_("50d:9389c704");var e=i("searchresults/tpi/data-api"),c=i("hotel/tpi/postproc-api"),r=i("searchresults/filters").getInstance,u=i("et"),f=i("jquery"),_="PPXGFRURURNZWVWAFC";function t(){var e;if(_i_("50d:7321fb73"),this.occupancy=B.env.wholesaler_configuration.availability_api_request.search_config.number_of_adults,u.track(_)){var t=i("searchresults/env");if(this.wholesaler_configuration=t.get("wholesaler_configuration"),this.hotel_candidate_list=[],this.hotels_with_no_rate=[],this.search_filters={},this.hotel_info_prices=this.wholesaler_configuration.hotel_info_prices,this.searchresults_ordered_by_price=this.wholesaler_configuration.searchresults_ordered_by_price,this.translations=this.wholesaler_configuration.b_wholesaler_translations,this.rtl=t.get("rtl"),this.search_filters_raw=r(),!this.search_filters_raw.filters["fc-2"]&&!this.search_filters_raw.filters["fc-5"])for(this.hotel_candidate_list=this.wholesaler_configuration.b_wholesaler_hotel_ids,this.wholesaler_configuration.hotels_with_no_rate&&(this.hotels_with_no_rate=this.wholesaler_configuration.hotels_with_no_rate),this.search_filters_raw.filters["mealplan-1"]&&(this.search_filters.has_breakfast=1),this.search_filters.price_slider_options=B.env.b_slider_options,e=1;e<=4;e++)if(this.search_filters_raw.filters["pri-"+e]){this.search_filters.price_range=e;break}}else if(this.hotel_candidate_list=[],this.hotels_with_no_rate=[],this.search_filters={},this.hotel_info_prices=B.env.wholesaler_configuration.hotel_info_prices,this.searchresults_ordered_by_price=B.env.wholesaler_configuration.searchresults_ordered_by_price,this.translations=B.env.wholesaler_configuration.b_wholesaler_translations,this.rtl=B.env.rtl,this.search_filters_raw=r(),!this.search_filters_raw.filters["fc-2"]&&!this.search_filters_raw.filters["fc-5"])for(this.hotel_candidate_list=B.env.wholesaler_configuration.b_wholesaler_hotel_ids,B.env.wholesaler_configuration.hotels_with_no_rate&&(this.hotels_with_no_rate=B.env.wholesaler_configuration.hotels_with_no_rate),this.search_filters_raw.filters["mealplan-1"]&&(this.search_filters.has_breakfast=1),e=1;e<=4;e++)if(this.search_filters_raw.filters["pri-"+e]){this.search_filters.price_range=e;break}_r_()}function p(e,t){_i_("50d:5347b80f");var i=t.find(".roomPrice"),r=B.jstmpl.translations("inclusive"===e.price_inclusion?"sr_search_card_includes_taxes_charges":"sr_hp_taxes_and_charges_exception");i.find(".tpi-price-inclusion__no-radio__caption").text(r),_r_()}function b(e,t){if(_i_("50d:3702a09b"),e.cancellation_information){var i=e.cancellation_information.refund_info;if(0<i.length&&"fully_refundable"===i[0].type){var r=t.find(".roomPrice"),_=B.jstmpl.translations("pod_sr_split_free_cancellation");r.find(".tpi-refund__caption").text(_)}}_r_()}function m(t,e){_i_("50d:85fa38c0");var i=e.find(".tpi_button_room_integration");e.click(function(){_i_("50d:09c986cd"),u.customGoal(_,1),_r_()}),i.click(function(e){_i_("50d:dd676a0a"),e.preventDefault(),window.open(t.noScrollUrl,"_blank"),_r_()}),_r_()}function v(e,t,i){_i_("50d:d5b07cff");var r=i.find(".bfast-included-ribbon"),_=i.find(".no_cc_02"),a=i.find(".b-no-cc-reinforcement__spacing"),o=t.find(".tpi_room_name_holder");e.room_info.meal_info.has_breakfast||r.hide(),_.hide(),a.hide(),i.find(".js_sr_persuation_msg").hide(),i.find(".c-unit-configuration").hide();var n=i.find(".ge-free-room-upgrade-ribbon"),s=i.find(".ge-free-room-upgrade-sr-text");(0<n.length||0<s.length)&&(n.hide(),s.hide()),t.find(".tpi_book_button_holder").show(),o.show(),_r_()}function l(e,i){_i_("50d:1f639a01"),e.find("a[href]").each(function(){_i_("50d:a79d53c4");var e=f(this).attr("href"),t=e.indexOf("#");-1===t?e+="&tpi_r="+i:e=e.slice(0,t)+"&tpi_r="+i+e.slice(t),f(this).attr("href",e),_r_()}),_r_()}t.prototype.render=function(e){_i_("50d:fdf69fd9"),this.search_filters_raw.filters["fc-2"]||this.search_filters_raw.filters["fc-5"]||this.processResult(e),_r_()},t.prototype.checkSearchFilters=function(e){var t;_i_("50d:bd73aa6a");for(var i=0;i<e.length;i++){var r=e[i],_=!1;if(f.isEmptyObject(this.search_filters))_=!0;else{var a=!0;if((a=(a=a&&(1!=this.search_filters.has_breakfast||r.room_info&&r.room_info.meal_info&&1===r.room_info.meal_info.has_breakfast))&&(!this.search_filters.price_range||1==this.search_filters.price_range))&&(_=!0),this.search_filters.price_slider_options){var o=this.search_filters.price_slider_options.min_selected,n=this.search_filters.price_slider_options.max_selected,s=r.price_user_currency;(n<s||s<o)&&(_=!1)}}if(_){t=r;break}}return _r_(t)},t.prototype.processResult=function(e){if(_i_("50d:3d43b29c"),e&&e.data&&200==e.status){for(var t={},i=0,r=[],_=0;_<this.hotel_candidate_list.length;_++){var a=this.hotel_candidate_list[_],o=e.data[a];if(o&&-1==this.hotels_with_no_rate.indexOf(a)){var n=this.checkSearchFilters(o);if(n){i++,r.push(""+a);var s=f("div.sr_item[data-hotelid='"+a+"']").addClass("hasTPIRateAvailable");s.length&&(this.injectTPIIntoRoomBlock(s,n,e.exps||{}),t[a]={hotel_block:s,room_info:n},l(s,1))}}}0<i&&(_i_("50d:34dd03a1"),f("div.sr_item:not(.hasTPIRateAvailable)").each(function(){_i_("50d:5de3eb7b"),l(f(this),2),_r_()}),_r_(),c.send_postproc_request(r)),this.sortTpiRooms(t)}_r_()},t.prototype.sortTpiRooms=function(e){if(_i_("50d:333a9240"),1===this.searchresults_ordered_by_price&&this.wholesaler_configuration.b_fix_price_sorting){var n,s,c=this.hotel_info_prices;for(n in e){var t=(s=e[n]).room_info.price_user_currency;s.price=t}for(n in e){if(0!=(s=e[n]).hotel_block.find("div.distfromdest--highlight").length)continue;var l=f("div.sr_item.sr_property_block");l.each(function(e){_i_("50d:91092359");var t=f(this),i=t.data("hotelid"),r=Number(c[i]);if(r&&e!==l.length-1)for(var _=e+1;_<l.length;_++){var a=f(l.eq(_)).data("hotelid"),o=Number(c[a]);if(o&&o<r){if(i==n)return _r_(!1);return _r_(!0)}if(0!=o)break}if(r&&r>=s.price)return s.hotel_block.detach(),t.before(s.hotel_block),c[i]=""+s.price,_r_(!1);if(e===l.length-1)return s.hotel_block.detach(),t.after(s.hotel_block),c[i]=""+s.price,_r_(!1);_r_()})}}_r_()},t.prototype.injectTPIIntoRoomBlock=function(e,t,i){var r;_i_("50d:16e4eb4e"),t.room_name&&(r=t.room_name),r||(r=t.room_info&&this.translations[t.room_info.booking_room_type]?this.translations[t.room_info.booking_room_type]:this.translations[20]);var _=0;this.rtl&&(_=1);var a=e.find(".room_details"),o=a.find(".sr_room_table"),n=a.find(".sr-cta-button-row");if(1===o.length){var s=function(e,t){_i_("50d:66df6f7c");var i={};return i.header=e.find("thead").clone(),i.url=e.find(".roomrow").attr("data-link"),i.noScrollUrl=t.find("a").attr("href"),i.occupancy=e.find(".room_link").find("div").clone(),i.price=e.find(".smart_price_style").clone(),i.roomReinforcment=e.find(".sr_room_reinforcement").clone(),i.bookButton=t.clone(),_r_(i)}(o,n),c={b_tpi_room_name:r,b_tpi_price:t.price_formatted,b_tpi_url:s.noScrollUrl,b_has_breakfast:t.room_info.meal_info.has_breakfast,b_is_rtl:_,prc_stay_night_num:B.env.tpi_los,prc_search_config:B.env.tpi_search_config,exps:i};2<this.occupancy&&u.track("PPXGFRURURYTbRSdC")&&(c.fe_occupancy=this.occupancy,a.contents().hide());var l=B.jstmpl("b_tpi_room_block_room_integration").render(c);a.append(l),null!=(h=a.find(".sr_room_table[data-table-type=tpi]"))&&null!=s&&(!function(e,t,i){_i_("50d:69f144de"),t.find(".tpi_room_name").append(e.occupancy);var r=t.find(".normal_book_button_holder");e.price.html('<label class="bui-radio__label normal_price_label" for="tpi_wholesale_price_radio">'+e.price.html()+"</label>"),e.header.addClass("tpi_room_table_header"),t.prepend(e.header),r.append(e.bookButton),i.hide(),t.find(".normal_price_label").addClass("tpi_radio_active"),_r_()}(s,h,o),v(t,h,e),m(s,h)),p(t,a),b(t,a),a.find(".roomrow").attr("data-link",s.url)}var f,d="PPXGFRURURYEIENHUFGbJEbOMFcWe";if(B.et.track(d)&&(e.find(".sold_out_property_wrapper").length?f=e.find(".sold_out_property_wrapper").parent():e.find(".simple_av_calendar_no_av").length&&(f=e.find(".simple_av_calendar_no_av").parent(),e.find(".sr_rooms_table_block").append('<div class="room_details"></div>'),a=e.find(".room_details")),f&&(B.et.stage(d,1),2==B.et.track(d)))){f.hide();s=function(e,t,i){_i_("50d:9d0a9b4e");var r={},_=e.find(".hotel_name_link").attr("href").split(";")[0],a=t.room_info.booking_room_id;return r.url=a?_+";show_room="+a+"#RD"+a:_,r.noScrollUrl=_+";hptv=do",r.occupancy='<div class="c-occupancy-icons " style="font-size: 10px; color: #000000"><span class="c-occupancy-icons__adults " aria-hidden="true">'+Array(i+1).join('<i class="bicon bicon-occupancy"></i>')+'</span><span class="bui-u-sr-only">Max people: '+i+"</span></div>",_r_(r)}(e,t,this.occupancy),c={b_tpi_room_name:r,b_tpi_price:t.price_formatted,b_tpi_url:s.noScrollUrl,b_has_breakfast:t.room_info.meal_info.has_breakfast,b_is_rtl:_,prc_stay_night_num:B.env.tpi_los,prc_search_config:B.env.tpi_search_config,exps:i};2<this.occupancy&&u.track("PPXGFRURURYTbRSdC")&&(c.fe_occupancy=this.occupancy,a.contents().hide());var h;l=B.jstmpl("b_tpi_room_block_room_integration").render(c);a.append(l),null!=(h=a.find(".sr_room_table[data-table-type=tpi]"))&&null!=s&&(h.find(".tpi_room_name").append(s.occupancy),v(t,h,e),m(s,h)),p(t,a),b(t,a),a.find(".roomrow").attr("data-link",s.url)}_r_()},e.onTpiData(function(e){_i_("50d:1f78dfa4"),(new t).render(e),_r_()}),_r_()});